#!/usr/bin/env bash
set -euo pipefail

log() {
  printf "[%s] %s\n" "$(date '+%H:%M:%S')" "$*"
}

tmux_plugins_dir="$HOME/personal/tmux/plugins"
tmux_sessions_dir="$HOME/personal/tmux/sessions"

mkdir -p "$tmux_plugins_dir"
mkdir -p "$tmux_sessions_dir"

[[ "${OSTYPE:-}" != darwin* ]] && sudo apt update

if ! command -v tmux &>/dev/null; then
  log "Installing tmux"
  if [[ "${OSTYPE:-}" == darwin* ]]; then
    brew install tmux
  else
    sudo apt install -y tmux
  fi
fi

if [[ ! -d "${tmux_plugins_dir}/tpm" ]]; then
  log "Installing TPM"
  git clone https://github.com/tmux-plugins/tpm "$tmux_plugins_dir/tpm" 2>/dev/null || true
fi

if [[ ! -d "$tmux_plugins_dir/resurrect" ]]; then
  log "Installing tmux-resurrect"
  git clone https://github.com/tmux-plugins/tmux-resurrect.git "$tmux_plugins_dir/resurrect" 2>/dev/null || true
fi

log "Done"
